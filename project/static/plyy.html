<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLYY</title>
    <link rel="stylesheet" href="../static/css/base.css"/>
</head>
<body>
    <div class="container">
        <div id="plyy_title"></div>
        <div id="line"></div>
        <div id="heart"></div>
        <div id="info">
            <div>
                <p id="date"></p>
            </div>
            <div id="curator"></div>
        </div>
        <div id="curate">
            <div id="tagContainer"></div>
            <div id="comment" class="comment"></div>
        </div>
        <li class="pointer" id="tracks"></li>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var url = window.location.href
            url = url.split('/')
            let plyyId = url[url.length - 1]
            fetchPlyyDetail(plyyId);
        });
        
        function fetchPlyyDetail(plyyId) {
            fetch(`/api/plyy/${plyyId}`)
            .then(response =>  response.json())
            .then(data => {
                document.title = data.info.plyy_title + ' | PLYY'
                const plyy_title = document.getElementById('plyy_title');
                const date = document.getElementById('date');
                const curator = document.getElementById('curator');
                const tagContainer = document.getElementById('tagContainer');
                const comment = document.getElementById('comment');
                plyy_title.textContent = data.info.plyy_title;
                date.innerHTML = '<p>발행일 : &nbsp;&nbsp;&nbsp;' + data.info.generate + '</p>'
                                + '<p>수정일 : &nbsp;&nbsp;&nbsp;' + data.info.update + '</p>';
                curator.innerHTML = '<p>큐레이터 : &nbsp;&nbsp;&nbsp;' + data.info.curator + '</p>'
                                + '<img src="../static/css/source/heart.svg">' + '<span>' + data.info.heart +'</span>';
                comment.textContent = data.info.comment;
                const genre = document.createElement('span');
                genre.textContent = '#' + data.info.genre;
                tagContainer.appendChild(genre);
                data.tags.forEach(data => {
                    const tag = document.createElement('span');
                    tag.textContent = '#' + data.tag_name;
                    tagContainer.appendChild(tag);
                });
                const lst = document.getElementById('tracks')
                data.tracks.forEach(track => {
                    const newItem = document.createElement('ul');
                    newItem.innerHTML = `<div onclick="location.href='./${plyyId}/${parseInt(track.song_index) + 1}'">`
                        + '<div>' + `<img src="${track.img}">` + '</div>'
                        + '<div>' + '<p>' + '<b>' + `${track.title}` + '</b>' + '</p>' 
                        + '<p>' + `${track.artist}` + '</p>' + '</div>';
                    lst.appendChild(newItem);
                })
            })
            .catch(error => console.error('데이터를 처리하는 과정에서 오류가 발생하였습니다.'))
        };

        // window.onload = function() {
        //     let url = window.location.href
        //     url = url.split('/')
        //     let plyyId = url[url.length - 1]
        //     fetchPlyyDetail(plyyId);
        // };
        </script>
</body>
</html>